<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fancy Todos App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body style="background-color: #a8bdc4; font-family: 'Roboto Condensed', sans-serif; height: 100%;">
    <!-- navbar -->
    <div id="navbar">
        <nav class="navbar navbar-light bg-light">
            <a class="navbar-brand" href="#">
            <img src="https://apprecs.org/gp/images/app-icons/300/8a/io.tinbits.memorigi.jpg" width="30" height="30" class="d-inline-block align-top" alt="" loading="lazy">
            My Todo List
            </a>
            <a class="btn navbar-btn btn-danger navbar-right" id="btn-logout">Logout</a>
        </nav>
    </div>

    <!-- form register -->
    <div id="register-page">
        <h1>Register Form</h1>
        <form id="register-form">
            <div class="form-group" >
              <label for="exampleInputEmail1">Email address</label>
              <input type="email" class="form-control" id="email-register" aria-describedby="emailHelp">
              <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword1">Password</label>
              <input type="password" class="form-control" id="password-register">
            </div>
            <button type="submit" class="btn btn-primary">Register</button><br>
            Already have a account? <a href="#" onclick="loginPage()">login</a>
          </form>
    </div>

    <!-- form login  -->
    <div id="login-page">
        <h1>Login Form</h1>
        <form id="login-form">
          <div class="form-group">
            <label for="exampleInputEmail1">Email address</label>
            <input type="email" class="form-control" id="email-login" aria-describedby="emailHelp">
            <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
          </div>
          <div class="form-group">
            <label for="exampleInputPassword1">Password</label>
            <input type="password" class="form-control" id="password-login">
          </div>
          <button type="submit" class="btn btn-primary">Login</button>
        </form>
    </div>

    <!-- form create todo -->
    <div id="create-page">
        <h1>Create New Todos</h1>
        <form id="create-form">
            <div class="form-group">
              <label for="input-title">Title</label>
              <input type="text" class="form-control" id="title-create" aria-describedby="titlelHelp">
              </div>
            <div class="form-group">
                <label for="input-description">description</label>
                <input type="text" class="form-control" id="description-create" aria-describedby="descriptionlHelp">
              </div>
            <div class="form-group">
                <label for="input-status">Status</label>
                <input type="text" class="form-control" id="status-create" aria-describedby="statuslHelp">
              </div>
              <div class="form-group">
                <label for="input-due_date">Due Date</label>
                <input type="text" class="form-control" id="due_date-create" aria-describedby="due_datelHelp">
              </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
    </div>
    
    <!-- main todo -->
    <div id="main-page">
        <h1>INI MAIN PAGE NYA BELUM JADI</h1>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
        function mainPage() {
            $("#register-page").hide()
            $("#login-page").hide()
            $("#create-page").hide()
            $("#main-page").show()
            $("#btn-logout").show()
        }
        function registerPage() {
            $("#register-page").show()
            $("#login-page").hide()
            $("#create-page").hide()
            $("#main-page").hide()
            $("#btn-logout").hide()
        }
        function loginPage() {
            $("#register-page").hide()
            $("#login-page").show()
            $("#create-page").hide()
            $("#main-page").hide()
            $("#btn-logout").show()
        }
        function register() {
            $("#register-form").on("submit", function (event){
                event.preventDefault()
                const email = $("#email-register").val()
                const password = $("#password-register").val()
                
                // server routes register
                $.ajax({
                    url: "http://localhost:3000/register",
                    method: "POST",
                    data: {
                        email,
                        password,
                    }
                })
                .done(response => {
                    loginPage()
                })
                .fail((xhr, textStatus)=>{
                    console.log(xhr, textStatus);
                })
                .always(()=>{
                    $("#register-page").trigger('reset')
                })
            })
        }
        function login() {
            $("#login-form").on("submit", function (event){
                event.preventDefault()
                const email = $("#email-login").val()
                const password = $("#password-login").val()
                
                // server routes login
                $.ajax({
                    url: "http://localhost:3000/login",
                    method: "POST",
                    data: {
                        email,
                        password,
                    }
                })
                .done(response => {
                    localStorage.setItem("access_token", response.access_token)
                    mainPage()
                })
                .fail((xhr, textStatus)=>{
                    console.log(xhr, textStatus);
                })
            })
        }
        function logout() {
            localStorage.clear()
            loginPage()
        }
    
        $(document).ready(function () {

            $('#login-form').on('submit', function (event){
                event.preventDefault()
                login()
            })
            $("#regist-form").on("submit", function (event){
                event.preventDefault()
                register()
            })
            $("#btn-logout").on("click", function (event) {
                logout()
            })
            if (localStorage.getItem("access_token")) {
                mainPage()
            } else {
                registerPage()
            }
        })
    </script>
</body>
</html>